/*-----------------------------------------------------------------------
Source Name: account.c
System     : Budgetary Financial System.
Created  On: 25th Sept 91.
Created  By: C. Burns.

DESCRIPTION:
	Program to maintain G/L Salary Accounts.
	Validate options are Add, Change, Delete, Inquire, Next, Prev.

MODIFICATIONS:        

Programmer     YY/MM/DD       Description of modification
------------------------------------------------------------------------*/
#define	MAIN		/* Main program. This is to declare Switches */
#define MAINFL		SALARY		/* main file used */

#define	SYSTEM		"Setup"	/* Sub System Name */
#define	MOD_DATE	"25-SEPT-91"		/* Progran Last Modified */

#include <stdio.h>
#include <cfomstrc.h>
#include <bfs_defs.h>
#include <bfs_com.h>
#include <bfs_pp.h>

/* User Interface define constants */
#ifdef ENGLISH
#define ADDREC		'A'
#define CHANGE		'C'
#define DELETE		'D'
#define INQUIRE		'I'
#define EXITOPT		'E'
#define	NEXT		'N'
#define	PREV		'P'

#define	YES		'Y'
#define NO		'N'
#define	LINEEDIT	'L'
#define SCREENEDIT	'S'
#define	CANCEL		'C'

#else
#define ADDREC		'R'
#define CHANGE		'C'
#define DELETE		'E'
#define INQUIRE		'I'
#define EXITOPT		'F'
#define	NEXT		'S'
#define	PREV		'P'

#define	YES		'O'
#define NO		'N'
#define	LINEEDIT	'L'
#define SCREENEDIT	'S'
#define	CANCEL		'A'

#endif

#define	FOUND		0
#define	NOTFOUND	1

/* PROFOM Releted declarations */

#define	SCR_NAME	"account"	/* PROFOM screen Name */

/* PROFOM Screen STH file */

/* Field PROFOM numbers */

#define MAX_FIELD	12	/* Maximum Field# to edit */

#define	HDR_ST_FLD	1000	/* Header Start Field */
#define	HDR_END_FLD	2200	/* Header End Field */
#define	END_FLD		2400	/* Last Field of the screen */

/* HDR Fields */
#define	FN_FLD		400	/* Fn: */
#define	KEY_START	500	/* Student ID */
#define	KEY_END		700	/* Section */
#define	CHG_FLD		800	/* Field: */
#define	FUND_FLD	500	/* Fund */
#define	CLASS_FLD	600	/* Classification */
#define EARN_FLD	700	/* Earnings Code */

/* account.sth - header for C structure generated by PROFOM EDITOR */

typedef struct	{

	char	s_pgname[11];	/* 100 STRING X(10) */
	long	s_rundate;	/* 300 DATE YYYYFMMFDD */
	char	s_fn[2];	/* 500 STRING X */
	short	s_fund;		/* 500 NUMERIC 999 */
	char	s_class[7];	/* 600 STRING X(6) */
	char	s_earn[7];	/* 700 STRING X(6) */
	short	s_field;	/* 800 NUMERIC 99 */
	char	s_dummy[2];	/* 1000 STRING X */
	long	s_keys[NO_KEYS];/* 1100-2200 NUMERIC 99999 */
	char	s_mesg[78];	/* 6600 STRING X(76) */
	char	s_resp[2];	/* 6700 STRING X */
} s_struct;

static	long	effective;

static	s_struct  s_sth,image;	/* PROFOM Screen Structure */
static	struct  stat_rec  sr;		/* PROFOM status rec */

static	char 	e_mesg[100];  		/* dbh will return err msg in this */

static	Salary	salary;
static	Class	class;
static	Earn	earn;
static	Sch_rec	school;
static	Gl_acct	gl_acct;
static	Gl_rec	gl_rec;
static	Pay_param	pay_param;

int	Validation();
int	WindowHelp();
int	Argc;
char	**Argv;

void	free() ;
char	*malloc() ;
long	power();

main(argc,argv)
int argc;
char *argv[];
{
	int 	retval;

	/* These two are passed to execute() when it is called */
	Argc = argc;
	Argv = argv;

	retval = Initialize(argc,argv);	/* Initialization routine */

	retval = get_pay_param(&pay_param, BROWSE, 1, e_mesg) ;
	if(retval == ERROR) {
		fomen(e_mesg);
		get() ;
	}
	else  if(retval == UNDEF) {
#ifdef ENGLISH
		fomen("Payroll Parameters Are Not Setup..");
#else
		fomen("Parametres Payroll ne sont pas etablis..");
#endif
		get() ;
	}
	else
		 retval = Process();

	CloseRtn();			/* return to menu */
	if (retval != NOERROR) exit(-1);
	exit(0);
}

/*-------------------------------------------------------------------*/
/* Initialize PROFOM */

Initialize(argc, argv)
int	argc ;
char	*argv[] ;
{
	int	retval ;

	/*
	*	Initialize DBH Environment
	*/
	strncpy(SYS_NAME,SYSTEM,50);	/* Sub system name */
	strncpy(CHNG_DATE,MOD_DATE,10);	/* Modification Date */

	proc_switch(argc, argv, MAINFL) ; 	/* Process Switches */

	/*
	*	Initialize PROFOM & Screen
	*/
	strcpy(sr.termnm,terminal);	/* Copy Terminal Name */
	fomin(&sr);
	ret(err_chk(&sr)) ;		/* Check for PROFOM Error */
	fomcf(1,1);			/* Enable Snap screen option */

	retval = InitScreen() ;		/* Initialize Screen */
	if(NOERROR != retval) return(retval) ;

	return(NOERROR) ;
}	/* Initialize() */

/*--------------------------------------------------------------------------*/
/* Close nessary files and environment before exiting program               */

CloseRtn() 
{
	/* Set terminal back to normal mode from PROFOM */
	fomcs();
	fomrt();

	close_dbh();	/* Close files */

	return(NOERROR);
}	/*