/*-----------------------------------------------------------------------
Source Name: del_emp.c
Created  On: August 19, 1992.
Created  By: Eugene Roy.

DESCRIPTION:
	Program to Delete the Employee.

MODIFICATIONS:        

Programmer     YY/MM/DD       Description of modification
~~~~~~~~~~     ~~~~~~~~       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
------------------------------------------------------------------------*/

#define	MAIN

#include <stdio.h>
#include <cfomstrc.h>
#include <bfs_defs.h>
#include <bfs_pp.h>
#include <pp_msgs.h>

#define	SYSTEM		"PERSONNEL"	/* Sub System Name */
#define	MOD_DATE	"19-AUG-92"		/* Program Last Modified */

#define	ESC_F		1	/* ESC-F is active */

/* User Interface define constants */
#ifdef ENGLISH
#define	DELETE		'D'
#define EXITOPT		'E'

#define	YES		'Y'
#define	EDIT		'E'
#define	CANCEL		'C'
#else
#define	DELETE		'D'
#define EXITOPT		'F'

#define	YES		'O'
#define	EDIT		'M'

#define	CANCEL		'A'
#endif
/* PROFOM Releted declarations */

#define	SCR_NAME	"del_emp"	/* PROFOM screen Name */

/* PROFOM Screen STH file */

/* Field PROFOM numbers */

#define	OPTION_FLD	1100	/* Option: */
#define	KEY_START	400	/* Key Start Field */
#define	KEY_END		1000	/* Key Start Field */
#define	END_FLD		1300	/* Last Field of the screen */
#define	EMP_FLD		400	/* Employee Cd: */
#define	EMPNAME_FLD	500	/* Employee Name: */
#define	POSTALCD_FLD	1000	/* Postal Code: */

/* deselect.sth - header for C structure generated by PROFOM EDITOR */

struct	s_struct	{

	char	s_pgm[11];	/* STRING XXXXXXXXXX Field 100 */
	long	s_rundate;	/* DATE YYYYFMMFDD Field 300 */
	char	s_emp[13];	/* STRING XXXXXXXXXX Field 400 */
	char	s_name[31];	/* STRING X[30] Field 500 */
	char	s_add1[31];	/* STRING X[30] Field 600 */
	char	s_add2[31];	/* STRING X[30] Field 700 */
	char	s_add3[31];	/* STRING X[30] Field 800 */
	char	s_add4[31];	/* STRING X[30] Field 900 */
	char	s_pc[11];	/* STRING X[7] Field 1000 */
	char	s_option[2];	/* STRING X Field 1100 */
	char	s_mesg[78];	/* STRING X[77] Field 1200 */
	char	s_resp[2];	/* STRING X Field 1300 */
};

static	struct	s_struct  s_sth;	/* PROFOM Screen Structure */

static	struct  	stat_rec  sr;	/* PROFOM status rec */


static	Time	time_rec;
static	Time_his	time_his;
static	Pay_earn	pp_earn;
static	Pp_ben		pp_ben;
static	Pay_ded		pp_ded;
static	Pay_loan	pp_loan;
static	Pay_garn	pp_garn;
static	Chq_mess_ass	chq_mess_ass;
static	Jr_ent		jr_ent;
static	Jrh_ent		jr_ent_his;	/* Journal Entry File		*/
static	Aud_pay	aud_pay;
static	Ec_rec	ec_rec;
static	Chq_reg	chq_reg ;	/* Cheque Register record */
static	Man_chq		man_chq;
static	Roe	roe;
static	Reg_pen_adj	reg_pen_adj;

static	Emp	emp_rec;
static	Emp_emp	emp_emp;	/* Employee file	*/
static	Emp_extra	emp_extra;	/* Employee file	*/
static	Emp_earn	emp_earn;
static	Emp_sched1	emp_sched1;	/* Employee file	*/
static	Emp_sched2	emp_sched2;	/* Employee file	*/
static	Emp_ins	emp_ins;
static	Emp_ben	emp_ben;
static	Emp_bh	emp_bh;
static	Emp_ded	emp_ded;
static	Emp_dh	emp_dh;
static	Emp_garn	emp_garn;
static	Emp_gr_his	emp_gh;
static	Emp_loan	emp_loan;
static	Emp_ln_his	emp_lh;
static	Emp_at_his	emp_att;
static	Teach_ass	teach_ass;
static	Teach_qual	teach_qual;
static	Tmp_sched1	tmp_sched1;
static	Emp_sen	emp_sen;
static	Tmp_sen	tmp_sen;
static	T4_adj	t4_adj;
static	Ts_sen	ts_sen;
static	Tmp2_Emp	tmp2_emp;
static	Tmp_Emp	tmp_emp;

char 		e_mesg[100];	/* dbh will return err msg in this */

int	Validate(), WindowHelp() ;
double	D_Roundoff();

/*------------------------------------------------------------------------*/

main(argc,argv)
int	argc;
char	*argv[];
{
	int	err;

	if(argc < 2){
#ifdef  DEVELOP
		printf("MAIN ARGUMENTS ARE NOT PROPER\n");
		printf("Usage: %s {-tTerminal Name} {-dDist#} [{-sSwitches}]\n",
			argv[0]);
#endif
		exit(1);
	}

	err = Initialize(argc,argv) ;	/* Initialize Variables , DBH
						Environment and PROFOM */
	if(err == NOERROR) err = Process();	/* Initiate Process */

	CloseProcess() ;

	if(err != NOERROR)exit(1);
	exit(0);
}	/* main() */
/*-------------------------------------------------------------------*/
/* Initialize Variables, PROFOM, DBH etc. */

Initialize(argc, argv)
int	argc ;
char	*argv[] ;
{
	int	i ;

	/*
	*	Initialize DBH Environment
	*/
	strncpy(SYS_NAME,SYSTEM,50);	/* Sub system name */
	strncpy(CHNG_DATE,MOD_DATE,10);	/* Modification Date */

	proc_switch(argc, argv, CHEQUE) ;	/* Process Switches */

	/*
	*	Initialize PROFOM & Menu Screen
	*/
	STRCPY(sr.termnm,terminal);	/* Copy Terminal Name */
	fomin(&sr);
	ret(err_chk(&sr)) ;		/* Check for PROFOM Error */
	fomcf(1,1);			/* Enable Snap screen option */

	/* move screen name to Profom status structure */
	STRCPY(sr.scrnam,NFM_PATH);
	strcat(sr.scrnam,SCR_NAME) ;

	/* Initialize SCR */
	STRCPY(s_sth.s_pgm,PROG_NAME);
	s_sth.s_rundate = get_date();	/* get Today's Date in YYYYMMDD format*/
	s_sth.s_mesg[0] = HV_CHAR ;
	s_sth.s_resp[0] = HV_CHAR ;

	MoveLVs() ;

	ret(WriteFields((char*)&s_sth,EMP_FLD, END_FLD) );

	return(NOERROR) ;
}	/* Initialize() */
/*-------------------------------------------------------------------*/
/* Get Option: from user and call corresponding function */

Process()
{
	int err;

	for( ; ; ){
		/* Get the Option: from the user */
		if((err = ReadOption()) != NOERROR) return(err) ;

		err = ProcOption() ;	/* Process Option */

		if(QUIT == err)		return(NOERROR) ;	/* Exit */
		if(NOACCESS == err)	fomen(e_mesg);
		if(PROFOM_ERR == err)	return(PROFOM_ERR);  /* PROFOM ERROR */
		if(DBH_ERR == err) {
			DispError((char *)&s_sth,e_mesg);
#ifdef ENGLISH
			sprintf(e_mesg,"%s %d Dberror: %d Errno: %d",
				"System Error... Iserror:",
				iserror, dberror, errno);
#else
			sprintf(e_mesg,"%s %d Dberror: %d Errno: %d",
				"Erreur du systeme... Iserror:",
				iserror, dberror, errno);
#endif
			DispError((char *)&s_sth,e_mesg);
			return(DBH_ERR);	/* DBH ERROR */
		}
	}      /*   end of the for( ; ; )       */
}	/* Process() */
/*----------------------------------------------------------------*/
/* Close necessary files and environment before exiting program */

CloseProcess()
{
	/* Set terminal back to normal mode from PROFOM */
	fomcs();
	fomrt();

	close_dbh();	/* Close DBH(files) */

	return(NOERROR) ;
}	/* CloseProcess() */
/*----------------------------------------------------------------*/
/* Display the Options (Option:) and get the option from the user */

ReadOption()
{
	/* Display options */
#ifdef ENGLISH
	fomer("D(elete), E(xit)");
#else
	fomer("E(liminer), F(in)");
#endif
	/* Read Option: field */
	sr.nextfld = OPTION_FLD ;
	fomrf( (char *)&s_sth );
	ret(err_chk(&sr));	/* Check for PROFOM error */

	return(NOERROR) ;
}	/* ReadOption() */
/*----------------------------------------------------------------*/
/* Process the user selected option */

ProcOption()
{
	int retval;

	switch (s_sth.s_option[0]) {
	case DELETE  :		/* De-Select */
		CHKACC(retval,P_DEL,e_mesg);
		return( DeSelectProcess() ) ;
	case EXITOPT  :			/* Exit */
		return( QUIT ) ;
	}  /*   end of the switch statement */

	if(retval<0) 
		return(retval);

	return(NOERROR);
}	/* ProcOption() */
/*-----------------------------------------------------------------------*/
/* Take the Keys for de-selection from the user. When he confirms it
   do the de-selection */

DeSelectProcess()
{
	int	err ;

	/* If the Current Period == 0 (i.e before yearly closing), Add or
	   Change is not allowed */

	err = GetItemKey() ;
	if(PROFOM_ERR == err || DBH_ERR == err) return(err) ;
	if(NOERROR != err) {
		MoveLVs() ;
		ret( WriteFields((char *)&s_sth,KEY_START, POSTALCD_FLD) ) ;
		roll_back(e_mesg) ;	/* Unlock the locked Records */
		return(err) ;
	}

	err = Chg_Emp() ;
	if(NOERROR != err) {
		roll_back(e_mesg) ;
		return(err) ;
	}

	return(NOERROR) ;
}	/* DeSelectProcess() */
/*----------------------------------------------------------------------*/
/* Get the De-selection key from user */

GetItemKey()
{
	int	i;

	for(i = KEY_START ; i <= KEY_END ; i += 100)
		fomca1(i,19,0) ;

#ifdef ENGLISH
	STRCPY(s_sth.s_mesg,"Press ESC-F to Go Back to Fn:");
#else
	STRCPY(s_sth.s_mesg,"Appuyer sur ESC-F pour retourner a Fn:");
#endif
	DispMesgFld((char *)&s_sth);

	MoveLVs() ;

	i = ReadFields((char *)&s_sth,KEY_START, KEY_END, Validate,WindowHelp,1) ;
	if(PROFOM_ERR == i || DBH_ERR == i) return(i) ;
	if(RET_USER_ESC == i){
		s_sth.s_mesg[0] = HV_CHAR;
	DispMesgFld((char *)&s_sth);
		return(ERROR) ;
	}

	i = Confirm() ;		/* Confirm the Selection */
	if(i != YES) return(i) ;

	return(NOERROR);
}	/*  GetItemKey() */
/*-----------------------------------------------------------------------*/
/* Take the confirmation from user for the keys */

Confirm()
{
	int	err ;

	for( ; ; ) {
#ifdef ENGLISH
		err = GetOption((char *)&s_sth,"Y(es), E(dit), C(ancel)", "YEC");
#else
		err = GetOption((char *)&s_sth,"O(ui), M(odifier), A(nnuler)", "OMA");
#endif
		if(err == PROFOM_ERR) return(err) ;

		switch(err) {
		case  YES :
		    return(YES) ;
		case  EDIT  :
		    err = ChangeItemKey();
		    break ;
		case  CANCEL :
#ifdef ENGLISH
		    err = GetOption((char *)&s_sth,"Confirm the Cancel (Y/N)?", "YN") ;
#else
		    err = GetOption((char *)&s_sth,"Confirmer l'annulation (O/N)?", "ON") ;
#endif
		    if(err == YES) return(CANCEL) ;
		    break ;
		}	/* switch err */

		if(err == PROFOM_ERR) return(err) ;
		if(err == DBH_ERR) return(err) ;
	}	/* for(; ; ) */
}	/* Confirm() */
/*----------------------------------------------------------------------*/
/* Changing user given keys */

ChangeItemKey()
{
	int	i;

	for(i = KEY_START ; i <= KEY_END ; i += 100)
		fomca1(i,19,2) ;

	sr.nextfld = KEY_START ;
	sr.endfld  = KEY_END ;
	fomud((char*)&s_sth) ;
	ret(err_chk(&sr));

	MoveLVs() ;

	i = ReadFields((char *)&s_sth,KEY_START, KEY_END,Validate,WindowHelp,1) ;
	if(i < 0) return(i) ;

	return(NOERROR);
}	/* ChangeItemKey() */
/*----------------------------------------------------------------*/
/* Validation function() for Data fields when PROFOM returns RET_VAL_CHK */

Validate()
{
	int	err ;
	int	save_nextfld, save_endfld;

	switch(sr.curfld){
	case	EMP_FLD	:	/* Employee #: */
		err = CheckEmp(s_sth.s_emp,UPDATE) ;
		if(DBH_ERR == err) return(err) ;
		if(ERROR == err) {
			s_sth.s_emp[0] = LV_CHAR ;
			return(ERROR) ;
		}
		err = DisplayAddress() ;
		if(NOERROR != err) return(err) ;
		
		break ;
	default :
#ifdef ENGLISH
		sprintf(e_mesg,"No Validity Check For Field#  %d",sr.curfld);
#else
		sprintf(e_mesg,"Pas de controle de validite pour le Champ#  %d",sr.curfld);
#endif
		fomen(e_mesg);
		get();
		return(ERROR) ;
	}	/* Switch sr.curfld */

	return(NOERROR) ;
}	/* Validate() */
/*----------------------------------------------------------------*/
/* Show Help Windows, if applicable, when user gives ESC-H */

WindowHelp()
{
	int	err ;

	switch(sr.curfld){
	case	EMP_FLD	:
		err = emp_hlp(s_sth.s_emp, 7, 13 );
		if(err == DBH_ERR) return(err) ;
		if(err >=0 ) redraw();
		if(err < 1) return(ERROR) ;

		err = CheckEmp(s_sth.s_emp,UPDATE) ;
		if(DBH_ERR == err) return(err) ;
		if(ERROR == err) {
			s_sth.s_emp[0] = LV_CHAR ;
			return(ERROR) ;
		}
		err = DisplayAddress() ;
		if(NOERROR != err) return(err) ;
		break ;
	default :
#ifdef ENGLISH
		fomer("No Help Window For This Field");
#else
		fomer("Pas de fenetre d'assistance pour ce champ");
#endif
		return(ERROR) ;
	}

	return(NOERROR) ;
}	/* WindowHelp() */
/*-------------------------------------------------------------------------*/
/* Display the employee Name and Address */

DisplayAddress()
{
	int	curfld, endfld ;

	curfld = sr.curfld ;
	endfld = sr.endfld ;

	strcpy(s_sth.s_name,emp_rec.em_first_name);
	strcat(s_sth.s_name,", ");
	strcat(s_sth.s_name,emp_rec.em_last_name);
	if(emp_rec.em_add1[0] == '\0')
		s_sth.s_add1[0] = ' ' ;
	else
		strcpy(s_sth.s_add1, emp_rec.em_add1) ;
	if(emp_rec.em_add2[0] == '\0')
		s_sth.s_add2[0] = ' ' ;
	else
		strcpy(s_sth.s_add2, emp_rec.em_add2) ;
	if(emp_rec.em_add3[0] == '\0')
		s_sth.s_add3[0] = ' ' ;
	else
		strcpy(s_sth.s_add3, emp_rec.em_add3) ;
	if(emp_rec.em_add4[0] == '\0')
		s_sth.s_add4[0] = ' ' ;
	else
		strcpy(s_sth.s_add4, emp_rec.em_add4) ;
	if(emp_rec.em_pc[0] == '\0')
		s_sth.s_pc[0] = ' ' ;
	else
		strcpy(s_sth.s_pc  , emp_rec.em_pc  ) ;

	ret( WriteFields((char *)&s_sth, EMPNAME_FLD, POSTALCD_FLD)) ;

	return(NOERROR) ;
}	/* DisplayAddress() */
/*-------------------------------------------------------------------------*/
/* MOve low values to screen data fields */

MoveLVs()
{
	s_sth.s_emp[0] = LV_CHAR ;

	s_sth.s_name[0] = LV_CHAR ;
	s_sth.s_add1[0] = LV_CHAR ;
	s_sth.s_add2[0] = LV_CHAR ;
	s_sth.s_add3[0] = LV_CHAR ;
	s_sth.s_add4[0] = LV_CHAR ;
	s_sth.s_pc[0]   = LV_CHAR ;

	return(NOERROR) ;
}	/* MoveLVs()() */
/*----------------------------------------------------------------*/
/* Check the given Employee availability in file */

CheckEmp(emp,mode)
char	*emp ;
int	mode ;
{
	int	err ;
	Right_Justify_Numeric(emp,(sizeof(emp_rec.em_numb)-1));
	STRCPY(emp_rec.em_numb,emp) ;
	err = get_employee(&emp_rec, mode, 0, e_mesg) ;
	if(err < 0) {
		fomen(NOKEY) ;
		return(ERROR) ;
	}
	err=UsrBargVal(UPDATE,emp_rec.em_numb,emp_rec.em_barg,1,e_mesg);
	if(err < 0){
		DispError((char *)&s_sth,e_mesg);
		return(ERROR);
	}
	

	return(NOERROR) ;
}	/* CheckEmp() */
/*----------------------------------------------------------------*/
/*  Deselect employee's selected for payment			*/

Chg_Emp()
{
	int	retval ;

	strcpy(emp_rec.em_numb, s_sth.s_emp);

	retval = get_employee(&emp_rec,UPDATE, 0, e_mesg) ;
	if(retval < 0 && retval != UNDEF) {
		roll_back(e_mesg);
		DispError((char *)&s_sth,e_mesg) ;
		return(ERROR) ;
	}

	retval = put_employee(&emp_rec,P_DEL,e_mesg) ;
	if(retval < 0) {
		DispError((char *)&s_sth,e_mesg);
		roll_back(e_mesg);
		return(retval);
	}

	retval = commit(e_mesg) ;
	if(retval < 0) {
		DispError((char *)&s_sth,"ERROR: Saving Records"); 
		DispError((char *)&s_sth,e_mesg);
		roll_back(e_mesg);
		return(retval);
	}

	close_file(EMPLOYEE);

	strcpy(emp_sched1.es_numb,s_sth.s_emp) ;
	emp_sched1.es_week = 0;
	emp_sched1.es_fund = 0;
	emp_sched1.es_class[0] ='\0' ;
	emp_sched1.es_cost = 0;
	emp_sched1.es_dept[0] ='\0' ;
	emp_sched1.es_area[0] ='\0' ;
	flg_reset(EMP_SCHED1);
	
	for( ; ; ){
		retval = get_n_emp_sched1(&emp_sched1,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_sched1.es_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_sched1(&emp_sched1,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}

	}
	seq_over(EMP_SCHED1);
	close_file(EMP_SCHED1);

	strcpy(emp_sched2.es2_numb,s_sth.s_emp) ;
	emp_sched2.es2_week = 0;
	flg_reset(EMP_SCHED2);
	
	for( ; ; ){
		retval=get_n_emp_sched2(&emp_sched2,UPDATE,0,FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_sched2.es2_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_sched2(&emp_sched2,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}

	}
	seq_over(EMP_SCHED2);
	close_file(EMP_SCHED2);

	strcpy(emp_extra.ee_numb,s_sth.s_emp) ;
	emp_extra.ee_type[0] = '\0' ;
	emp_extra.ee_class[0] = '\0' ;
	flg_reset(EMP_EXTRA);
	
	for( ; ; ){
		retval = get_n_emp_extra(&emp_extra,UPDATE, 0,FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_extra.ee_numb,s_sth.s_emp) != 0)
			break;

		retval = put_emp_extra(&emp_extra,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_EXTRA);
	close_file(EMP_EXTRA);

	strcpy(emp_earn.en_numb,s_sth.s_emp) ;
	emp_earn.en_pp = 0;
	emp_earn.en_week = 0;
	emp_earn.en_date = 0;
	flg_reset(EMP_EARN);
	
	for( ; ; ){
		retval = get_n_emp_earn(&emp_earn,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_earn.en_numb,s_sth.s_emp) != 0)
			break;

		retval = put_emp_earn(&emp_earn,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_EARN);
	close_file(EMP_EARN);

	strcpy(emp_ins.in_numb,s_sth.s_emp) ;
	emp_ins.in_pp = 0;
	emp_ins.in_date = 0;
	flg_reset(EMP_INS);
	
	for( ; ; ){
		retval = get_n_emp_ins(&emp_ins,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_ins.in_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_ins(&emp_ins,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_INS);
	close_file(EMP_INS);

	strcpy(emp_ben.eb_numb,s_sth.s_emp) ;
	emp_ben.eb_code[0] = '\0';
	emp_ben.eb_pp_code[0] = '\0';
	flg_reset(EMP_BEN);
	
	for( ; ; ){
		retval = get_n_emp_ben(&emp_ben,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_ben.eb_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_ben(&emp_ben,P_DEL,e_mesg) ;

		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_BEN);
	close_file(EMP_BEN);

	strcpy(emp_ded.ed_numb,s_sth.s_emp) ;
	emp_ded.ed_code[0] = '\0';
	emp_ded.ed_group[0] = '\0';
	flg_reset(EMP_DED);
	
	for( ; ; ){
		retval = get_n_emp_ded(&emp_ded,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_ded.ed_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_ded(&emp_ded,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_DED);
	close_file(EMP_DED);

	strcpy(emp_bh.ebh_numb,s_sth.s_emp) ;
	emp_bh.ebh_pp = 0;
	emp_bh.ebh_date = 0;
	emp_bh.ebh_code[0] = '\0';
	flg_reset(EMP_BEN_HIS);
	
	for( ; ; ){
		retval = get_n_emp_bhis(&emp_bh,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_bh.ebh_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_bhis(&emp_bh,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_BEN_HIS);
	close_file(EMP_BEN_HIS);

	strcpy(emp_dh.edh_numb,s_sth.s_emp) ;
	emp_dh.edh_pp = 0;
	emp_dh.edh_date = 0;
	emp_dh.edh_code[0] = '\0';
	flg_reset(EMP_DED_HIS);
	
	for( ; ; ){
		retval = get_n_emp_dhis(&emp_dh,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_dh.edh_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_dhis(&emp_dh,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_DED_HIS);
	close_file(EMP_DED_HIS);

	strcpy(emp_loan.el_numb,s_sth.s_emp) ;
	emp_loan.el_code[0] = '\0';
	emp_loan.el_seq = 0;
	flg_reset(EMP_LOAN);
	
	for( ; ; ){
		retval = get_n_emp_loan(&emp_loan,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_loan.el_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_loan(&emp_loan,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_LOAN);
	close_file(EMP_LOAN);

	strcpy(emp_lh.elh_numb,s_sth.s_emp) ;
	emp_lh.elh_pp = 0;
	emp_lh.elh_date = 0;
	emp_loan.el_code[0] = '\0';
	emp_loan.el_seq = 0;
	flg_reset(EMP_LOAN_HIS);
	
	for( ; ; ){
		retval = get_n_emp_lhis(&emp_lh,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_lh.elh_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_lhis(&emp_lh,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_LOAN_HIS);
	close_file(EMP_LOAN_HIS);

	strcpy(emp_garn.eg_numb,s_sth.s_emp) ;
	emp_garn.eg_pr_cd = 0;
	emp_garn.eg_seq = 0;
	flg_reset(EMP_GARN);
	
	for( ; ; ){
		retval = get_n_emp_garn(&emp_garn,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_garn.eg_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_garn(&emp_garn,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_GARN);
	close_file(EMP_GARN);

	strcpy(emp_gh.egh_numb,s_sth.s_emp) ;
	emp_gh.egh_pp = 0;
	emp_gh.egh_date = 0;
	emp_gh.egh_pr_cd = 0;
	emp_gh.egh_seq = 0;
	flg_reset(EMP_GARN_HIS);
	
	for( ; ; ){
		retval = get_n_emp_ghis(&emp_gh,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_gh.egh_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_ghis(&emp_gh,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_GARN_HIS);
	close_file(EMP_GARN_HIS);

	strcpy(teach_ass.tc_numb,s_sth.s_emp) ;
	teach_ass.tc_cost = 0;
	teach_ass.tc_ar_sp[0] = '\0';
	flg_reset(TEACH_ASS);
	
	for( ; ; ){
		retval = get_n_teach_ass(&teach_ass,UPDATE,0,FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(teach_ass.tc_numb, s_sth.s_emp) != 0) break;

		retval = put_teach_ass(&teach_ass,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TEACH_ASS);
	close_file(TEACH_ASS);

	strcpy(teach_qual.tq_numb,s_sth.s_emp) ;
	teach_qual.tq_code[0] = '\0';
	flg_reset(TEACH_QUAL);
	
	for( ; ; ){
		retval = get_n_teach_qual(&teach_qual,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(teach_qual.tq_numb, s_sth.s_emp) != 0) break;

		retval = put_teach_qual(&teach_qual,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TEACH_QUAL);
	close_file(TEACH_QUAL);

	strcpy(emp_att.eah_numb,s_sth.s_emp) ;
	emp_att.eah_date = 0;
	flg_reset(EMP_ATT);
	
	for( ; ; ){
		retval = get_n_emp_at(&emp_att,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_att.eah_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_at(&emp_att,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_ATT);
	close_file(EMP_ATT);

	emp_att.eah_numb[0] = '\0';
	emp_att.eah_date = 0;
	flg_reset(EMP_ATT);
	
	for( ; ; ){
		retval = get_n_emp_at(&emp_att,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(emp_att.eah_teach, s_sth.s_emp) != 0){ 
			roll_back(e_mesg);
			continue;
		}

		emp_att.eah_teach[0] = '\0';
		retval = put_emp_at(&emp_att,UPDATE,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_ATT);
	close_file(EMP_ATT);

	strcpy(time_rec.tm_numb,s_sth.s_emp) ;
	time_rec.tm_date = 0;
	time_rec.tm_no = 0;
	flg_reset(TIME);
	
	for( ; ; ){
		retval = get_n_ptime(&time_rec,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(time_rec.tm_numb, s_sth.s_emp) != 0) break;

		retval = put_ptime(&time_rec,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TIME);
	close_file(TIME);

	time_rec.tm_numb[0] = '\0';
	time_rec.tm_date = 0;
	time_rec.tm_no = 0;
	flg_reset(TIME);
	
	for( ; ; ){
		retval = get_n_ptime(&time_rec,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(time_rec.tm_teach, s_sth.s_emp) != 0){
			roll_back(e_mesg);
			continue;
		}

		time_rec.tm_teach[0] = '\0';
		retval = put_ptime(&time_rec,UPDATE,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TIME);
	close_file(TIME);

	strcpy(time_his.tmh_numb,s_sth.s_emp) ;
	time_his.tmh_date = 0;
	time_his.tmh_no = 0;
	flg_reset(TIME_HIS);
	
	for( ; ; ){
		retval = get_n_time_his(&time_his,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(time_his.tmh_numb, s_sth.s_emp) != 0) break;

		retval = put_time_his(&time_his,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TIME_HIS);
	close_file(TIME_HIS);

	strcpy(pp_earn.pe_numb,s_sth.s_emp) ;
	pp_earn.pe_pp = 0;
	pp_earn.pe_date = 0;
	flg_reset(PP_EARN);

	for( ; ; ){
		retval = get_n_pp_earn(&pp_earn,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(pp_earn.pe_numb, s_sth.s_emp) != 0) break;

		retval = put_pp_earn(&pp_earn,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(PP_EARN);
	close_file(PP_EARN);

	strcpy(pp_ben.pb_numb,s_sth.s_emp) ;
	pp_ben.pb_pp = 0;
	pp_ben.pb_date = 0;
	pp_ben.pb_code[0] = '\0';
	pp_ben.pb_fund = 0;
	pp_ben.pb_acct[0] = '\0';
	flg_reset(PP_BEN);

	for( ; ; ){
		retval = get_n_pp_ben(&pp_ben,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(pp_ben.pb_numb, s_sth.s_emp) != 0) break;

		retval = put_pp_ben(&pp_ben,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(PP_BEN);
	close_file(PP_BEN);

	strcpy(pp_ded.pd_numb,s_sth.s_emp) ;
	pp_ded.pd_pp = 0;
	pp_ded.pd_date = 0;
	pp_ded.pd_code[0] = '\0';
	pp_ded.pd_group[0] = '\0';
	pp_ded.pd_fund = 0;
	pp_ded.pd_acct[0] = '\0';
	flg_reset(PP_DED);

	for( ; ; ){
		retval = get_n_pp_ded(&pp_ded,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(pp_ded.pd_numb, s_sth.s_emp) != 0) break;

		retval = put_pp_ded(&pp_ded,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(PP_DED);
	close_file(PP_DED);

	strcpy(pp_loan.pc_numb,s_sth.s_emp) ;
	pp_loan.pc_pp = 0;
	pp_loan.pc_date = 0;
	pp_loan.pc_code[0] = '\0';
	pp_loan.pc_seq = 0;
	pp_loan.pc_fund = 0;
	pp_loan.pc_acct[0] = '\0';
	flg_reset(PP_LOAN);

	for( ; ; ){
		retval = get_n_pp_loan(&pp_loan,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(pp_loan.pc_numb, s_sth.s_emp) != 0) break;

		retval = put_pp_loan(&pp_loan,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(PP_LOAN);
	close_file(PP_LOAN);

	strcpy(pp_garn.pg_numb,s_sth.s_emp) ;
	pp_garn.pg_pp = 0;
	pp_garn.pg_date = 0;
	pp_garn.pg_pr_cd = 0;
	pp_garn.pg_seq = 0;
	pp_garn.pg_fund = 0;
	pp_garn.pg_acct[0] = '\0';
	flg_reset(PP_GARN);

	for( ; ; ){
		retval = get_n_pp_garn(&pp_garn,UPDATE, 0, FORWARD, e_mesg) ;
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(pp_garn.pg_numb, s_sth.s_emp) != 0) break;

		retval = put_pp_garn(&pp_garn,P_DEL,e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(PP_GARN);
	close_file(PP_GARN);

	strcpy(jr_ent.jr_emp_numb,s_sth.s_emp);
	jr_ent.jr_fund = 0;
	jr_ent.jr_no = 0;
	flg_reset(JR_ENT);

	for( ; ;){
		retval = get_n_jr_ent(&jr_ent,UPDATE,1,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(jr_ent.jr_emp_numb, s_sth.s_emp) != 0) break;

		retval = put_jr_ent(&jr_ent,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}

		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(JR_ENT);
	close_file(JR_ENT);

	strcpy(jr_ent_his.jrh_emp_numb,s_sth.s_emp);
	jr_ent_his.jrh_code[0] = '\0';
	jr_ent_his.jrh_fund = 0;
	jr_ent_his.jrh_no = 0;
	flg_reset(JRH_ENT);

	for( ; ;){
		retval = get_n_jrh_ent(&jr_ent_his,UPDATE,1,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(jr_ent_his.jrh_emp_numb, s_sth.s_emp) != 0) break;

		retval = put_jrh_ent(&jr_ent_his,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}

		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(JRH_ENT);
	close_file(JRH_ENT);

	strcpy(chq_mess_ass.ma_numb,s_sth.s_emp);
	chq_mess_ass.ma_code[0] = '\0';
	flg_reset(CHQ_MESS_ASS);

	for( ; ;){
		retval = get_n_chq_ms_ass(&chq_mess_ass,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}
		if(strcmp(chq_mess_ass.ma_numb, s_sth.s_emp) != 0) break;

		retval = put_chq_ms_ass(&chq_mess_ass,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(CHQ_MESS_ASS);
	close_file(CHQ_MESS_ASS);

	strcpy(reg_pen_adj.rpa_numb,s_sth.s_emp);

	retval = get_rg_pen_adj(&reg_pen_adj,UPDATE,0,e_mesg);
	if(retval < 0 && retval != UNDEF) {
		roll_back(e_mesg);
		DispError((char *)&s_sth,e_mesg) ;
		return(ERROR) ;
	}

	if(retval != UNDEF){
		retval = put_rg_pen_adj(&reg_pen_adj,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	else
		roll_back(e_mesg);
	close_file(REG_PEN_ADJ);

	strcpy(aud_pay.aud_emp,s_sth.s_emp);
	aud_pay.aud_code[0] = '\0';
	flg_reset(AUD_PAY);

	for( ; ;){
		retval = get_n_aud_pay(&aud_pay,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(aud_pay.aud_emp, s_sth.s_emp) != 0) break;

		retval = put_aud_pay(&aud_pay,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(AUD_PAY);
	close_file(AUD_PAY);

	strcpy(ec_rec.ec_numb,s_sth.s_emp);

	retval = get_ec(&ec_rec,UPDATE,0,e_mesg) ;
	if( retval < 0 && retval != UNDEF) {
		DispError((char *)&s_sth,e_mesg) ;
		return(retval) ;
	}
	if(retval != UNDEF){
		retval = put_ec(&ec_rec,P_DEL,e_mesg);	
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			return(ERROR);
		}

		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	close_file(EC_REC);

	strcpy(chq_reg.cr_emp_numb,s_sth.s_emp);
	chq_reg.cr_numb = 0;
	chq_reg.cr_date = 0;
	flg_reset(CHQ_REG);

	for( ; ;){
		retval = get_n_chq_reg(&chq_reg,UPDATE,1,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(chq_reg.cr_emp_numb, s_sth.s_emp) != 0) break;

		retval = put_chq_reg(&chq_reg,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}

		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(CHQ_REG);
	close_file(CHQ_REG);

	strcpy(man_chq.mc_emp_numb,s_sth.s_emp);
	man_chq.mc_date = 0;
	man_chq.mc_chq_numb = 0;
	flg_reset(MAN_CHQ);

	for( ; ;){
		retval = get_n_man_chq(&man_chq,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(man_chq.mc_emp_numb, s_sth.s_emp) != 0) break;

		retval = put_man_chq(&man_chq,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(MAN_CHQ);
	close_file(MAN_CHQ);

	strcpy(roe.ro_emp_numb,s_sth.s_emp);

	retval = get_roe(&roe,UPDATE,0,e_mesg);
	if(retval < 0 && retval != UNDEF) {
		roll_back(e_mesg);
		DispError((char *)&s_sth,e_mesg) ;
		return(ERROR) ;
	}

	if(retval != UNDEF){
		retval = put_roe(&roe,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
	
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	else
		roll_back(e_mesg);
	close_file(ROE);

	strcpy(tmp_sched1.tm_numb,s_sth.s_emp);
	tmp_sched1.tm_class[0] = '\0';
	tmp_sched1.tm_cost = 0;
	tmp_sched1.tm_dept[0] = '\0';
	tmp_sched1.tm_area[0] = '\0';
	flg_reset(TMP_SCHED1);

	for( ; ;){
		retval = get_n_tmp_sched1(&tmp_sched1,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(tmp_sched1.tm_numb, s_sth.s_emp) != 0) break;

		retval = put_tmp_sched1(&tmp_sched1,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TMP_SCHED1);
	close_file(TMP_SCHED1);

	strcpy(emp_sen.esn_numb,s_sth.s_emp);
	emp_sen.esn_month = 0;
	emp_sen.esn_pos[0] = '\0';
	emp_sen.esn_class[0] = '\0';
	flg_reset(EMP_SEN);

	for( ; ;){
		retval = get_n_emp_sen(&emp_sen,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(emp_sen.esn_numb, s_sth.s_emp) != 0) break;

		retval = put_emp_sen(&emp_sen,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(EMP_SEN);
	close_file(EMP_SEN);

	strcpy(tmp_sen.tsn_numb,s_sth.s_emp);
	tmp_sen.tsn_month = 0;
	flg_reset(TMP_SEN);

	for( ; ;){
		retval = get_n_tmp_sen(&tmp_sen,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			roll_back(e_mesg);
			if(retval == EFL) break;
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(tmp_sen.tsn_numb, s_sth.s_emp) != 0) break;

		retval = put_tmp_sen(&tmp_sen,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TMP_SEN);
	close_file(TMP_SEN);

	strcpy(t4_adj.ta_numb,s_sth.s_emp);

	retval = get_t4_adj(&t4_adj,UPDATE,0,e_mesg);
	if(retval < 0 && retval != UNDEF) {
		DispError((char *)&s_sth,e_mesg) ;
		return(ERROR) ;
	}

	if(retval != UNDEF){
		retval = put_t4_adj(&t4_adj,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	else
		roll_back(e_mesg);
	close_file(T4_ADJ);

	strcpy(tmp_emp.tem_numb,s_sth.s_emp);

	retval = get_tmp_emp(&tmp_emp,UPDATE,0,e_mesg);
	if(retval < 0 && retval != UNDEF) {
		DispError((char *)&s_sth,e_mesg) ;
		return(ERROR) ;
	}

	if(retval != UNDEF){
		retval = put_tmp_emp(&tmp_emp,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	else
		roll_back(e_mesg);
	close_file(TMP_EMP);

	tmp2_emp.tem2_cc = 0;
	tmp2_emp.tem2_last_name[0] = '\0';
	tmp2_emp.tem2_first_name[0] = '\0';
	tmp2_emp.tem2_numb[0] = '\0';
	flg_reset(TMP2_EMP);

	for( ; ;){
		retval = get_n_tmp2_emp(&tmp2_emp,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			if(retval == EFL) break;
			roll_back(e_mesg);
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(tmp2_emp.tem2_numb, s_sth.s_emp) != 0){ 
			roll_back(e_mesg);
			continue;
		}

		retval = put_tmp2_emp(&tmp2_emp,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TMP2_EMP);
	close_file(TMP2_EMP);

	ts_sen.ts_barg[0] = '\0';
	ts_sen.ts_total_years = 0;
	ts_sen.ts_total_days = 0;
	ts_sen.ts_emp_numb[0] = '\0';
	flg_reset(TS_SEN);

	for( ; ;){
		retval = get_n_ts_sen(&ts_sen,UPDATE,0,FORWARD,e_mesg);
		if(retval < 0) {
			if(retval == EFL) break;
			roll_back(e_mesg);
			DispError((char *)&s_sth,e_mesg) ;
			return(ERROR) ;
		}

		if(strcmp(ts_sen.ts_emp_numb, s_sth.s_emp) != 0){
			roll_back(e_mesg);
			continue;
		}	

		retval = put_ts_sen(&ts_sen,P_DEL,e_mesg);	
		if(retval < 0) {
		 	DispError((char *)&s_sth,e_mesg);
		  	return(ERROR);
		}
		retval = commit(e_mesg) ;
		if(retval < 0) {
			DispError((char *)&s_sth,"ERROR: Saving Records"); 
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}
	}
	seq_over(TS_SEN);
	close_file(TS_SEN);
	return(NOERROR);
}
/*-------------------- E n d   O f   P r o g r a m ---------------------*/
