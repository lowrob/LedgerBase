/*------------------------------------------------------------------------
Source Name: roe_prt.c
System     : Personnel/Payroll.
Created  On: November 27, 1991.
Created  By: Eugene Roy.

DESCRIPTION:
	Program to print Record of Employments.

MODIFICATIONS:        

Programmer     YY/MM/DD       Description of modification
~~~~~~~~~~     ~~~~~~~~       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
------------------------------------------------------------------------*/
#define 	MAIN 

#include <stdio.h>
#include <cfomstrc.h>
#include <repdef.h>
#include <bfs_defs.h>
#include <bfs_com.h>
#include <bfs_pp.h>

#define	SYSTEM		"PERSONNEL/PAYROLL"	/* Sub System Name */
#define	MOD_DATE	"27-NOV-91"		/* Program Last Modified */
#define	SCR_NAME	"roe_prt"		/* First screen */

#define	ST_FLD		400 
#define	END_FLD		600 
#define MESG_FLD	700
#define PRINTER_FLD	400
#define OPTION_FLD	500

#define EXIT	12

#ifdef ENGLISH

#define PRINT	'P'
#define EXITOPT	'E'

#define	YES	'Y'
#define NO	'N'
#define EDIT	'E'
#define CANCEL	'C'

#else

#define PROCCHQ	'P'
#define EXITOPT	'F'

#define	YES	'O'
#define NO	'N'
#define EDIT	'M'
#define CANCEL	'A'

#endif
/* cheque.sth - header for C structure generated by PROFOM EDITOR */

typedef struct	{

	char	s_pgm[11];	/* STRING XXXXXXXXXX 	Field 100 */
	long	s_rundate;	/* NUMERIC 9999F99F99 	Field 300 */
	short	s_printer;	/* NUMERIC 99 		Field 800 */
	char	s_resp[2]; 	/* STRING X 		Field 900 */
	long	s_no_writ;	/* NUMERIC 99999 	Field 1000 */
	char	s_mesg[78];	/* STRING X(78) 	Field 1500 */
	char	s_opt[2];	/* STRING X 		Field 1600 */
	} S_STRUCT;

static	S_STRUCT	s_sth ;

/* PROFOM Related variables */

struct  	stat_rec  sr;	/* PROFOM status rec */

static	Pa_rec	param;
static	Gov_param	gov_param;
static	Pay_param	pay_param;
static	Barg_unit	barg_unit;
static	Sch_rec	scho;
static	Pay_per	pay_per;
static	Position	position;
static	Roe	roe;
static	Emp	emp_rec;

char 	e_mesg[100];	/* dbh will return err msg in this */
static	char	temp_buf[80] ;	/* work variable for tedit */
static	int	no_lines;

int	Validation();
int	Window();

double 	D_Roundoff();

static	char	emp_name[48];
static	short	tot_num_ins_wk;
static	double	total;

main(argc,argv)
int argc;
char *argv[];
{
int 	retval ;

	strncpy(SYS_NAME,SYSTEM,50);	/* Sub system name */
	strncpy(CHNG_DATE,MOD_DATE,10);	/* Modification Date */
	proc_switch(argc, argv, CHQHIST) ; 	/* Process Switches */

	STRCPY(sr.termnm,terminal);	/* Copy Terminal Name */

	if (Initialize()<0)
		exit(-1);		/* Initialization routine */

	if ( Process() < 0) { 		/* Initiate Process */
		Close();
		exit(-1);
	}

	Close();			/* return to menu */
	exit(NOERROR);

} /* END OF MAIN */

/*-------------------------------------------------------------------*/
/* Reset information */
Close()
{
	/* Set terminal back to normal mode from PROFOM */

	fomcs();
	fomrt();
	close_dbh();			/* Close files */
	close_rep();
}
/*-------------------------------------------------------------------*/
/* Initialize PROFOM  and Screens*/
Initialize()
{
	if(InitProfom()<0) { 			/* Initialize PROFOM */
		fomcs();
		fomrt();
		return(-1);
	}	
	if(InitScreens()<0) { 
		fomcs();
		fomrt();
		return(-1);
	}	
	return(NOERROR);
}

/*-------------------------------------------------------------------*/
/* Initialize PROFOM */

InitProfom()
{
	fomin(&sr);
	/* Check for Error */
	ret( err_chk(&sr) );

	fomcf(1,1);			/* Enable Print screen option */
	return(NOERROR);
}	/* InitProfom() */
/*----------------------------------------------------------------*/
/* Initialize screens before going to process options */
InitScreens()
{
	int	retval ;

	STRCPY(sr.scrnam,NFM_PATH);
	strcat(sr.scrnam,SCR_NAME) ;

	STRCPY(s_sth.s_pgm,PROG_NAME);
	s_sth.s_rundate = get_date();	/* get Today's Date in YYMMDD format */
	s_sth.s_mesg[0] = HV_CHAR ;
	s_sth.s_opt[0] = HV_CHAR ;

	/* Move High Values to 1st screen data fields & Display */
	retval = ClearScreen() ;
	if( retval < 0 ) return(-1) ;

	return(NOERROR);

}	/* InitScreens() */
/*-----------------------------------------------------------------*/
InitPrinter()
{
	char	resp[2] ;
	char	discfile[15] ;

	/* Always to Printer */
	STRCPY( resp, "P" );
	discfile[0] = '\0';

	if( opn_prnt( resp, discfile, s_sth.s_printer, e_mesg, 0 )<0 ){
		fomen(e_mesg); get();
		return(-1);
	}
	return(NOERROR) ;
}
/*-----------------------------------------------------------------*/
InitPrinter1()
{
	char	resp[2] ;
	char	discfile[15] ;

	/* Always to Printer */
	STRCPY( resp, "F" );
	strcpy(discfile,"roe.dat");

	if( opn_prnt( resp, discfile, s_sth.s_printer, e_mesg, 0 )<0 ){
		fomen(e_mesg); get();
		return(-1);
	}
	return(NOERROR) ;
}
/*-----------------------------------------------------------------*/
/* Clears the screen. 						   */
ClearScreen()
{
	s_sth.s_resp[0] = LV_CHAR ;
	
	return(WriteFields((char *)&s_sth,ST_FLD,END_FLD) ) ;
}
/*-----------------------------------------------------------------*/
Process()
{
	int	err;

	s_sth.s_mesg[0] = HV_CHAR;
	DispMesgFld((char *)&s_sth);	
	for( ; ; ){

#ifdef ENGLISH
		fomer("P(rint), E(xit)");
#else
		fomer("I(mprimer), F(in)");
#endif
		sr.nextfld = OPTION_FLD;
		fomrf((char *)&s_sth);
		ret(err_chk(&sr));

		switch(s_sth.s_resp[0]) {
		case  EXITOPT :
			return(EXIT);
		case  PRINT :
			CHKACC(err,ADD,e_mesg);	
			CHKACC(err,UPDATE,e_mesg);	
			err = RoeProcess() ;
			break ;
		default :
			continue;
		}

		if(NOACCESS == err) {
			fomen(e_mesg);
			get();
		}
		if(PROFOM_ERR == err)	return(PROFOM_ERR);  /* PROFOM ERROR */
		if(DBH_ERR == err) {
			DispError((char *)&s_sth,e_mesg);
#ifdef ENGLISH
			sprintf(e_mesg,"%s %d Dberror: %d Errno: %d",
				"System Error... Iserror:",
				iserror, dberror, errno);
#else
			sprintf(e_mesg,"%s %d Dberror: %d Errno: %d",
				"Erreur du systeme... Iserror:",
				iserror, dberror, errno);
#endif
			DispError((char *)&s_sth,e_mesg);
			return(DBH_ERR); /* DBH ERROR */
		
		}
	}      /*   end of the for( ; ; )       */
}
/*-----------------------------------------------------------------*/
RoeProcess()
{
	int 	retval ;
	int	prntno;
	char	devname[30];

	retval = ReadInfo() ;
	if( retval < 0 ) return(retval) ;
	if( retval == EXIT ) return(NOERROR) ;

	retval = ConfirmScreen() ;
	if( retval != YES ) 
		return(NOERROR) ;
	
#ifdef ENGLISH
        retval = GetOption((char *)&s_sth, "Are you ready to print ROEs (Y/N)?","YN") ;
#else
        retval = GetOption((char *)&s_sth, "Etes-vous prets a imprimer les releve d'emplois (O/N)?","ON") ;
#endif

	if(retval != YES) 
	return(NOERROR) ;

	LNSZ = 132;		/* line size in no. of chars */
	if(InitPrinter()<0) {
		return(-1);
	}	

	retval = DoTestPrint() ;

	close_rep();
	if(InitPrinter1()<0) {
		return(-1);
	}	

	retval = RoeProc();
	if( retval < 0 ) 
		return(retval) ;

	close_rep();

	/* Printer option */
	prntno = s_sth.s_printer;
	retval = get_prn_fd(prntno,devname);
	if(retval < 0){

#ifdef ENGLISH
		strcpy(s_sth.s_mesg,"Given Printer# NOT Found in Terminal/Printer ");
		strcat(s_sth.s_mesg,"Maintenance File");
#else
		strcpy(s_sth.s_mesg,"#d'imprimante donne pas retrouve dans le Dossier d'entretien");
		strcat(s_sth.s_mesg," du term/imprimante");
#endif
		return(-1);
	}

	strcpy(e_mesg,"cat roe.dat > ");
	strcat(e_mesg,devname);
	system(e_mesg);
	strcpy(e_mesg,"echo  > ");
	strcat(e_mesg,devname);
	system(e_mesg);

	DispMesgFld((char *)&s_sth);
	fflush(stdout) ;
	retval = WriteFields((char *)&s_sth,ST_FLD,END_FLD) ;

	return(NOERROR) ;
 
}
/*-----------------------------------------------------------------------*/
/*                                                                       */
/* Reads Cheque processing information.                                  */
ReadInfo()
{
	int 	i,retval ;

	/* In Add mode turn off dup control for key fields.
	   Other modes reverse it */
	fomca1(750,19,2) ;	/* The printer duplication and ESC F */
	fomca1(750,10,1) ;

	sr.endfld = PRINTER_FLD;
	fomud((char*)&s_sth);	/* Update Dup Buffers */

#ifdef ENGLISH
	STRCPY(s_sth.s_mesg,"Press ESC-F to Go Back to Option:");
#else
	STRCPY(s_sth.s_mesg,"Appuyer sur ESC-F pour retourner a Option:");
#endif
	DispMesgFld((char *)&s_sth);

	if (retval < 0) return(retval) ; 
	s_sth.s_printer = 1 ;
	retval = WriteFields((char *)&s_sth,PRINTER_FLD,PRINTER_FLD) ;
	if (retval < 0) return(retval) ; 
	s_sth.s_printer = LV_SHORT ;

	i = ReadFields((char *)&s_sth,PRINTER_FLD, PRINTER_FLD,Validation,Window,1); 
	if(PROFOM_ERR == i || DBH_ERR == i) return(i) ;
	if(EXIT == i){
		s_sth.s_mesg[0] = HV_CHAR;
		DispMesgFld((char *)&s_sth);
		return(i) ;
	}
	return(NOERROR) ;
}

/*-----------------------------------------------------------------------*/
/*  Printing the Test as many times needed for cheques to line up        */
DoTestPrint()
{
	int 	i,	retval ;

	STRCPY(temp_buf, "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX") ;

	for( ; ; ) {
#ifdef ENGLISH
		retval = GetOption((char *)&s_sth,"Do you want a Test Print (Y/N)?","YN") ;
#else
		retval = GetOption((char *)&s_sth,"Desirez-vous un test d'impression (O/N)?","ON") ;
#endif

		if( retval == NO ) 
			break ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(30,"XXXXXXXXXX",10) ;
		mkln(58,"XXXXXXXXXXXXXXXXXXXX",20) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		mkln(58,"XXXXXXXXXXXXXXXXXXXX",20) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		if( prnt_line() < 0) return(-1) ;
	
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		mkln(58,"X",1) ;
		mkln(70,"X",1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
	
		mkln(42,"XXX",3) ;
		mkln(46,"XXX",3) ;
		mkln(58,"XXXXXXXXXXXXXXXXX",17) ;
		if( prnt_line() < 0) return(-1) ;
	
		if( prnt_line() < 0) return(-1) ;
		mkln(58,"XXXXXXXXXXX",11) ;
		if( prnt_line() < 0) return(-1) ;
	
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30);
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		mkln(74,"99",2) ; 
		mkln(78,"99",2) ; 
		mkln(82,"99",2) ; 
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		mkln(74,"99",2) ; 
		mkln(78,"99",2) ; 
		mkln(82,"99",2) ; 
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"ZZZZZZZZZ9",10) ;
		mkln(74,"99",2) ; 
		mkln(78,"99",2) ; 
		mkln(82,"99",2) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(8,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",30) ;
		mkln(74,"99",2) ; 
		mkln(78,"99",2) ; 
		mkln(82,"99",2) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(8,"X",1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		for(i=0;i<5;i++){
			mkln(7,"Z,ZZ9.99",8) ; 
			mkln(19,"9",1) ; 
			mkln(27,"Z,ZZ9.99",8) ; 
			mkln(39,"9",1) ; 
			mkln(48,"Z,ZZ9.99",8) ; 
			mkln(59,"9",1) ; 
			mkln(67,"Z,ZZ9.99",8) ; 
			mkln(79,"9",1) ; 
			if( prnt_line() < 0) return(-1) ;
			if( prnt_line() < 0) return(-1) ;
		}

		mkln(27,"Z Z Z Z 9",9) ; 
		mkln(79,"9 9",3) ; 
		if( prnt_line() < 0) return(-1) ;

		for(i=0;i<3;i++)
			if( prnt_line() < 0) return(-1) ;

		mkln(6,"Z,ZZ9.99",8) ; 
		mkln(25,"99",2) ; 
		mkln(29,"99",2) ; 
		mkln(33,"99",2) ; 
		mkln(36,"Z,ZZ9.99",8) ; 
		mkln(45,"99",2) ; 
		mkln(49,"99",2) ; 
		mkln(53,"99",2) ; 
		mkln(56,"Z,ZZ9.99",8) ; 
		mkln(65,"99",2) ; 
		mkln(69,"99",2) ; 
		mkln(73,"99",2) ; 
		mkln(76,"Z,ZZ9.99",8) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(4,"XXXXXXXXXXXXXXX",15) ; 
		mkln(21,"Z,ZZ9.99",8) ; 
		mkln(30,"XXXXXXXXXXXXXXX",15) ; 
		mkln(48,"Z,ZZ9.99",8) ; 
		mkln(58,"XXXXXXXXXXXXXXX",15) ; 
		mkln(75,"Z,ZZ9.99",8) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(53,"X",1) ; 
		mkln(59,"X",1) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(72,"XXXXXXXXXXX",11) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(10,"99",2) ; 
		mkln(13,"99",2) ; 
		mkln(16,"99",2) ; 
		mkln(23,"99",2) ; 
		mkln(38,"ZZZ9.99",7) ; 
		mkln(48,"XXXXXXXXXXXXXXX",15) ; 
		mkln(70,"999-999-9999",12) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(12,"99",2) ; 
		mkln(16,"99",2) ; 
		mkln(20,"99",2) ; 
		mkln(23,"9",1) ; 
		mkln(35,"9",1) ; 
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		mkln(48,"XXXXXXXXXXXXXXXXXXXXXXXXX",25) ; 

		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;
		if( prnt_line() < 0) return(-1) ;

		mkln(47,"999",3) ; 
		mkln(52,"999",3) ; 
		mkln(57,"9999",4) ; 
		mkln(64,"9999",4) ; 
		mkln(75,"99",2) ; 
		mkln(79,"99",2) ; 
		mkln(83,"99",2) ; 
		if( prnt_line() < 0) return(-1) ;

		rite_top();

#ifdef ENGLISH
		fomen("The Test Print Is Printing. Press any key to continue.");
#else
		fomen("La copie d'essaie imprime. Appuyer une touche pour continuer.");
#endif
		get();
	}
	return(NOERROR) ;
}
/*-----------------------------------------------------------------------*/
/*                                                                       */
/* Reads the cheque and prints the cheque after accumulating invoices.   */
RoeProc()
{
	int	retval ;

#ifdef ENGLISH
	STRCPY(s_sth.s_mesg, "ROE's being Printed, PLEASE WAIT");
#else
	STRCPY(s_sth.s_mesg, "Les RELEVE D"EMPLOI sont en train d'etre imprimes, ATTENDEZ S.V.P.");
#endif
	DispMesgFld((char *)&s_sth);
	fflush(stdout) ;

	s_sth.s_no_writ = 0 ;
	
	retval = get_param(&param,BROWSE,1,e_mesg);
	if(retval < 0){
		DispError((char *)&s_sth,e_mesg) ;
		roll_back(e_mesg);
		return(-1);
	}

	retval = get_pay_param(&pay_param,BROWSE,1,e_mesg);
	if(retval < 0){
		DispError((char *)&s_sth,e_mesg) ;
		roll_back(e_mesg);
		return(-1);
	}

	gov_param.gp_eff_date = get_date();

	flg_reset(GOV_PARAM);

	retval = get_n_gov_param(&gov_param,BROWSE, 0, BACKWARD, e_mesg) ;
	if(retval == EFL) {
		fomen("Government Parameter Record Not Setup");
		return(retval);
	}
	if(retval < 0) {
		fomer(e_mesg) ;
		return(ERROR) ;
	}

	scho.sc_numb = param.pa_distccno; 

	retval = get_sch(&scho,BROWSE,0,e_mesg);
	if(retval < 0){
		DispError((char *)&s_sth,e_mesg) ;
		return(-1);
	}

	roe.ro_emp_numb[0] = LV_CHAR;
	flg_reset(ROE) ;

	for( ; ; ){
		retval = get_n_roe(&roe,BROWSE,0,FORWARD,e_mesg) ;
		if(retval == EFL) 
			break;

		if( retval < 0) {
			DispError((char *)&s_sth,e_mesg) ;
			return(retval) ;
		}

		strcpy(emp_rec.em_numb,roe.ro_emp_numb);

		retval = get_employee(&emp_rec,UPDATE,0,e_mesg);
		if(retval < 0){
			DispError((char *)&s_sth,e_mesg) ;
			return(-1);
		}
		retval = PrntRec() ;
		if(retval < 0){
			DispError((char *)&s_sth,e_mesg) ;
			roll_back(e_mesg);
			return(retval);
		}

		emp_rec.em_last_roe = roe.ro_last_dt;
		emp_rec.em_num_ins_wk = tot_num_ins_wk;
		emp_rec.em_term_dt =  roe.ro_last_dt;
		strcpy(emp_rec.em_term, roe.ro_reason);

		retval = put_employee(&emp_rec,UPDATE,e_mesg);
		if(retval < 0) {
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}

		retval = commit(e_mesg) ;
		if(retval < 0) {
#ifdef ENGLISH
		DispError((char *)&s_sth,"ERROR in Saving Records"); 
#else
		DispError((char *)&s_sth,"ERREUR en conservant les fiches");
#endif
			DispError((char *)&s_sth,e_mesg);
			roll_back(e_mesg);
			return(retval);
		}

		s_sth.s_no_writ++ ;
		WriteFields((char *)&s_sth,ST_FLD,END_FLD);
	}
	seq_over(ROE);

	if(s_sth.s_no_writ == 0){
#ifdef ENGLISH
		DispError((char *)&s_sth,"No ROE to Print");
#else
		DispError((char *)&s_sth,"Pas de releve d'emploi a imprimer");

#endif
		return(ERROR) ;
	}

#ifdef ENGLISH
	STRCPY(s_sth.s_mesg, "ROE Printed Successfully");
#else
	STRCPY(s_sth.s_mesg, "Impression des RELEVE D'EMPLOI reussie");
#endif
	DispMesgFld((char *)&s_sth) ;
	fflush(stdout) ;

	unlink_file(ROE);

	return(NOERROR) ;

}

/*----------------------------------------------------------------*/
/* Validation function() for Key and Header fields when PROFOM returns
  RET_VAL_CHK */

Validation()
{
	return(NOERROR) ;
}	/* Validation() */
/*----------------------------------------------------------------*/
Window()
{
	return(NOERROR);
}
/*-----------------------------------------------------------------------*/
/*                                                                       */
ConfirmScreen() 
{
	int	err ;

	for( ; ; ) {
#ifdef ENGLISH
		err = GetOption((char *)&s_sth,"Y(es), E(dit), C(ancel)", "YEC");
#else
		err = GetOption((char *)&s_sth,"O(ui), M(odifier), A(nnuler)",
									 "OMA");
#endif
		if(err == PROFOM_ERR) return(err) ;

		switch(err) {
		case  YES :
			return(YES) ;
		case  EDIT  :
			err = ReadInfo();
			break ;
		case  CANCEL :
#ifdef ENGLISH
			err = GetOption((char *)&s_sth,"Confirm the Cancel (Y/N)?", "YN") ;
#else
			err = GetOption((char *)&s_sth,"Confirmer l'annulation (O/N)?", "ON") ;
#endif
			if(err == YES) { 
				roll_back(e_mesg) ;	/* Unlock  Records */
				return(CANCEL) ;
			}
			break ;
		}	/* switch err */

		if(err == PROFOM_ERR) return(err) ;
		if(err == DBH_ERR) return(err) ;
	}	/* for(; ; ) */
}	/* ConfirmScreen() */

/*----------------------------------------------------------------------------*/
/*  Print Roe information				      */

PrntRec()
{
	int	retval, i;
	long	tel1, tel2, tel3;

	strcpy(position.p_code,emp_rec.em_pos);

	retval = get_position(&position,BROWSE,0,e_mesg);
	if(retval < 0){
		DispError((char *)&s_sth,e_mesg) ;
	}

	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(30,roe.ro_serial,10) ;
	mkln(58,emp_rec.em_numb,12) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(8,scho.sc_name,28) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(8,scho.sc_add1,30) ;
	if(strcmp(position.p_type,"PT") == 0 ||
		strcmp(position.p_type,"FT") == 0)
		mkln(58,gov_param.gp_empl_ref,20) ;
	else
		mkln(58,gov_param.gp_tax_acct,20) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(8,scho.sc_add2,30) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(8,scho.sc_add3,30) ;
	if(strcmp(emp_rec.em_lang,"F") == 0)
		mkln(70,"X",1) ;
	else
		mkln(58,"X",1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(42,scho.sc_pc,8) ;

	strcpy(pay_per.pp_code,pay_param.pr_payper);
	pay_per.pp_year = 9999;
	flg_reset(PAY_PERIOD);

	retval = get_n_pay_per(&pay_per,BROWSE,0,BACKWARD,e_mesg);
	if(retval < 0){
		DispError((char *)&s_sth,e_mesg) ;
	}
	if(strcmp(pay_per.pp_code,pay_param.pr_payper)!=0){
		fomer("Error Reading Pay Period File");
	}
	seq_over(PAY_PERIOD);

	mkln(58,pay_per.pp_desc,17) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(58,emp_rec.em_sin,3);
	mkln(61,"-",1);
	mkln(62,emp_rec.em_sin+3,3);
	mkln(65,"-",1);
	mkln(66,emp_rec.em_sin+6,3);
	if( prnt_line() < 0) return(-1) ;

	strcpy(emp_name,emp_rec.em_last_name);
	strcat(emp_name,", ");
	strcat(emp_name,emp_rec.em_first_name);

	mkln(8,emp_name,30) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(8,emp_rec.em_add1,30) ;

	SetupDate(roe.ro_first_dt,temp_buf);
	mkln(74,temp_buf,10) ; 
	if( prnt_line() < 0) return(-1) ;

	mkln(8,emp_rec.em_add2,30) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(8,emp_rec.em_add3,30) ;

	SetupDate(roe.ro_last_dt,temp_buf);
	mkln(74,temp_buf,10) ; 
	if( prnt_line() < 0) return(-1) ;

	mkln(8,emp_rec.em_add4,30) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(9,emp_rec.em_pc,10) ;

	SetupDate(roe.ro_uic_prdt,temp_buf);
	mkln(74,temp_buf,10) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(8,position.p_desc,30) ;

	SetupDate(roe.ro_final_dt,temp_buf);
	mkln(74,temp_buf,10) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	if(roe.ro_all_wks_max[0] == 'Y')
		mkln(8,"X",1) ;

	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	retval = PrntRec2();
	if(retval < 0){
		DispError((char *)&s_sth,e_mesg) ;
		return(-1);
	}
	tedit((char*)&roe.ro_vac,"_,___._0",temp_buf,R_DOUBLE);
	mkln(6,temp_buf,8) ; 
	SetupDate(roe.ro_stat1_dt,temp_buf);
	mkln(25,temp_buf,10) ; 
	tedit((char*)&roe.ro_stat1_amnt,"_,___._0",temp_buf,R_DOUBLE);
	mkln(36,temp_buf,8) ; 
	SetupDate(roe.ro_stat2_dt,temp_buf);
	mkln(45,temp_buf,10) ; 
	tedit((char*)&roe.ro_stat2_amnt,"_,___._0",temp_buf,R_DOUBLE);
	mkln(56,temp_buf,8) ; 
	SetupDate(roe.ro_stat3_dt,temp_buf);
	mkln(65,temp_buf,10) ; 
	tedit((char*)&roe.ro_stat3_amnt,"_,___._0",temp_buf,R_DOUBLE);
	mkln(76,temp_buf,8) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(4,roe.ro_reas1,15) ; 
	tedit((char*)&roe.ro_reas1_amnt,"_,___._0",temp_buf,R_DOUBLE);
	mkln(21,temp_buf,8) ; 
	mkln(30,roe.ro_reas2,15) ; 
	tedit((char*)&roe.ro_reas2_amnt,"_,___._0",temp_buf,R_DOUBLE);

	mkln(48,temp_buf,8) ; 
	mkln(58,roe.ro_reas3,15) ; 
	tedit((char*)&roe.ro_reas3_amnt,"_,___._0",temp_buf,R_DOUBLE);
	mkln(75,temp_buf,8) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	if(strcmp(roe.ro_all,"Y") == 0)
		mkln(53,"X",1) ; 
	if(strcmp(roe.ro_all,"N") == 0)
		mkln(59,"X",1) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(72,roe.ro_reason,1) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	SetupDate(roe.ro_start_dt,temp_buf);
	mkln(10,temp_buf,10) ; 
	tedit((char*)&roe.ro_week_dno,"__",temp_buf,R_SHORT);
	mkln(23,temp_buf,2) ; 
	tedit((char*)&roe.ro_amnt,"____._0",temp_buf,R_DOUBLE);
	mkln(38,temp_buf,7) ; 
	mkln(48,roe.ro_contact,15) ; 
	strcpy(temp_buf,roe.ro_cntct_tel);
	Format_Str(temp_buf,"___-___-____");
	mkln(70,temp_buf,12) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	SetupDate(roe.ro_ret_dt,temp_buf);
	mkln(11,temp_buf,10) ; 

	if(roe.ro_ret_dt == 0)
		mkln(35,"X",1) ; 
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	mkln(4,roe.ro_com1,30) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(4,roe.ro_com2,30) ;
	if( prnt_line() < 0) return(-1) ;
	mkln(4,roe.ro_com3,30) ;
	mkln(48,roe.ro_issuer,25) ; 
	if( prnt_line() < 0) return(-1) ;
	mkln(4,roe.ro_com4,30) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	strcpy(temp_buf,roe.ro_issuer_tel);
	Format_Str(temp_buf,"___  ___  ____");
	mkln(47,temp_buf,14) ; 
	mkln(64,pay_param.pr_tel_ext,4) ; 

	SetupDate(roe.ro_issue_dt,temp_buf);
	mkln(75,temp_buf,10) ; 
	if( prnt_line() < 0) return(-1) ;

	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;
	if( prnt_line() < 0) return(-1) ;

	rite_top();
	
	return(NOERROR) ;
}
/*----------------------------------------------------------------------------*/
/*  Prints Cheque after all cheque stub information is printed		      */
PrntRec2()
{
	int	i,j,k,retval;
	double	fraction;
	long	dollars;

	total = 0;
	tot_num_ins_wk = 0;
	k = 0;
	if(roe.ro_all_wks_max[0] != 'Y'){
	  for(i=0;i<5;i++){
	    for(j=0;j<4;j++){
		if(j == 0){
		  tedit((char*)&roe.ro_ins_earn[k],"_,___._0",
						temp_buf,R_DOUBLE);
	  	  mkln(7,temp_buf,8) ; 
		  if(roe.ro_ins_wks[k] != 2){
		    tedit((char*)&roe.ro_ins_wks[k],"0",temp_buf,R_SHORT);
	  	    mkln(19,temp_buf,1) ; 
		  }
		}
		if(j == 1){
		  tedit((char*)&roe.ro_ins_earn[k],"_,___._0",
						temp_buf,R_DOUBLE);
	  	  mkln(27,temp_buf,8) ; 
		  if(roe.ro_ins_wks[k] != 2){
		    tedit((char*)&roe.ro_ins_wks[k],"0",temp_buf,R_SHORT);
	  	    mkln(39,temp_buf,1) ; 
		  }
		}
		if(j == 2){
		  tedit((char*)&roe.ro_ins_earn[k],"_,___._0",
						temp_buf,R_DOUBLE);
	  	  mkln(48,temp_buf,8) ; 
		  if(roe.ro_ins_wks[k] != 2){
		    tedit((char*)&roe.ro_ins_wks[k],"0",temp_buf,R_SHORT);
	  	    mkln(59,temp_buf,1) ; 
		  }
		}
		if(j == 3){
		  tedit((char*)&roe.ro_ins_earn[k],"_,___._0",
						temp_buf,R_DOUBLE);
	  	  mkln(67,temp_buf,8) ; 
		  if(roe.ro_ins_wks[k] != 2){
		    tedit((char*)&roe.ro_ins_wks[k],"0",temp_buf,R_SHORT);
	  	    mkln(79,temp_buf,1) ; 
		  }
		}
		total += roe.ro_ins_earn[k];

		k++;
	    }
	    if( prnt_line() < 0) return(-1) ;
	    if( prnt_line() < 0) return(-1) ;
	  }
	}
	else{
	    for(i=0;i<20;i++)
		total += roe.ro_ins_earn[i];
	    for(i=0;i<10;i++)
	    	if( prnt_line() < 0) return(-1) ;
	}

	for(i=0;i<20;i++)
		tot_num_ins_wk += roe.ro_ins_wks[i];

	dollars = (long)total;
	fraction = total - (double)dollars;
	if(fraction > 0.49)
		dollars += 1;	
	tedit((char*)&dollars,"_ _ _ _ _",temp_buf,R_LONG);
	mkln(27,temp_buf,9) ; 
	tedit((char*)&roe.ro_ins_week,"_ _",temp_buf,R_SHORT);
	mkln(79,temp_buf,3) ; 
	if( prnt_line() < 0) return(-1) ;

	for(i=0;i<3;i++)
		if( prnt_line() < 0) return(-1) ;

	return(NOERROR) ;
}
/*----------------------------------------------------------------------------*/
/*  Setup Date		      */

SetupDate(ldate,sdate)
long	ldate;
char	*sdate;
{
	long	dd, mm, yy;

	if(ldate <=0){
		sprintf(sdate,"          ");
	}
	else{
		ldate -= 19000000;
		dd = ldate % 100;
		mm = (ldate / 100) % 100;
		yy = ldate / 10000;
		sprintf(sdate,"%02d  %02d  %02d",dd,mm,yy);
	}
}

/*----------------------------------------------------------------------------*/
/*  Setup Date		      */

Format_Str(string,mask)
char	*string, *mask;
{
	int	len;
	int	cnt=0;
	char	output[20];

	for(len=0; len<strlen(mask);len++){
		if(mask[len] == '_') {
			output[len] = string[cnt];
			cnt++;
		}
		else
			output[len] = mask[len];
	}
	strcpy(string,output);
}
/*-------------------- E n d   O f   P r o g r a m ---------------------*/
